name: Nexus Intelligence Suite

on:
  schedule:
    - cron: '0 * * * *'      # Hourly Trading & AI Training
    - cron: '0 20 * * 0'     # Weekly Report: Every Sunday 8PM UTC
    - cron: '0 20 1 * *'     # Monthly Report: 1st of the month 8PM UTC
  workflow_dispatch:          # Allows you to click "Run" for an instant report

jobs:
  nexus-ops:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Python Setup
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
      - name: Deps
        run: pip install pandas requests ccxt scikit-learn plotly streamlit
      
      - name: Execute Intelligence
        env:
          DISCORD_WEBHOOK_URL: ${{ secrets.DISCORD_WEBHOOK_URL }}
        run: |
          python train_brain.py
          python run_consensus.py
          python sanity_check.py
          
          # Scheduled Reporting Logic
          if [[ "${{ github.event_name }}" == "workflow_dispatch" ]]; then
            python nexus_reporter.py --full
          elif [[ "${{ github.event.schedule }}" == "0 20 * * 0" ]]; then
            python nexus_reporter.py --full
          fi

      - name: Sync Data
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git add *.db *.json *.pkl
          git commit -m "Intelligence Sync" || echo "No changes"
          git push
